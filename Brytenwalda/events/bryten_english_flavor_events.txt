namespace = bryten_england

#######################################
# Norman Conquest Stuff
#######################################
bryten_england.0001 = {# William the Conquerer is Coronated in London at Westminister Abbey.
	type = character_event
	title = bryten_england.0001.t
	desc = bryten_england.0001.desc
	theme = realm
	left_portrait = {
		character = root
		animation = personality_bold
	}

	trigger = {
		this = character:140
		has_primary_title = title:k_england
		is_at_war = no # In case Hardrada is still gunning for the throne, Willy will go and fight him first. 
	}
	
	option = {# Interesting
		name = bryten_england.0001.coronation
		title:k_england = {# Willy's capital is now in London
			set_capital_county = title:c_middlesex
		}
	}
}

#######################################
# Embrace English culture
#######################################
bryten_england.100 = {# English culture forming
	type = character_event
	title = bryten_england.100.t
	desc = bryten_england.100.desc
	theme = culture_change
	left_portrait = {
		character = scope:embracer
		animation = personality_bold
	}

	immediate = {
		culture:english = {
			reset_culture_creation_date = yes
			get_all_innovations_from = culture:norman
			get_all_innovations_from = culture:anglo_saxon
		}
		set_global_variable = {
			name = bryten_english_created
			value = yes
		}
	}

	trigger = {
		not = {	exists = global_var:bryten_english_created } # Fire Only Once
		has_title = title:k_england
		any_county_in_region = {# To ensure that you actually rule over england
			region = custom_england
			count >= 28
			OR = {
				holder = root
				holder = {
					any_liege_or_above = { this = root }
				}
			}
		}
		culture = { has_cultural_pillar = heritage_frankish }
		any_county_in_region = {# 
			region = custom_england
			culture = { has_cultural_pillar = heritage_west_germanic }
		}
		current_date >= 1150.1.1
	}

	option = {# Interesting
		name = bryten_england.100.culture
		random_county_in_region = {
			region = custom_england
			limit = { 
				culture = { has_cultural_pillar = heritage_west_germanic }
				NOT = {	culture = culture:english }
			}
			set_county_culture = culture:english
			save_scope_as = bryten_english_county
		}
	}

	after = {
		if = {
			limit = {
				any_vassal_or_below = {
					has_title = scope:bryten_english_county
					NOT = {	has_title = title:k_england	}
				}
			}
			trigger_event = {
				id = bryten_england.101
			}
		}
	}

}
bryten_england.101 = {# English culture spreading - County Ruler is informed
	type = character_event
	title = bryten_england.101.t
	desc = bryten_england.101.desc
	theme = culture_change

	option = {# Interesting
		name = bryten_england.101.culture
	}

}
bryten_england.102 = {# Cities are adopting English Culture
	type = character_event
	title = bryten_england.102.t
	desc = bryten_england.102.desc
	theme = culture_change


	immediate = {
		if = {# Winchester
			limit = { has_title = title:c_hampton }
			title:c_hampton = {
				save_scope_as = bryten_english_winchester
			}
			set_global_variable = {
				name = bryten_english_created_winchester
				value = yes
			}
		}
		if = {# York
			limit = { has_title = title:c_north_riding }
			title:c_north_riding = {
				save_scope_as = bryten_english_york
			}
			set_global_variable = {
				name = bryten_english_created_york
				value = yes
			}
		}
		if = {# London
			limit = { has_title = title:c_middlesex }
			title:c_middlesex = {
				save_scope_as = bryten_english_london
			}
			set_global_variable = {
				name = bryten_english_created_london
				value = yes
			}
		}		
		if = {# Oxford
			limit = { has_title = title:c_oxfordshire }
			title:c_oxfordshire = {
				save_scope_as = bryten_english_oxford
			}
			set_global_variable = {
				name = bryten_english_created_oxford
				value = yes
			}
		}
		if = {# Lincoln
			limit = { has_title = title:c_lincolnshire }
			title:c_lincolnshire = {
				save_scope_as = bryten_english_lincoln
			}
			set_global_variable = {
				name = bryten_english_created_lincoln
				value = yes
			}
		}
		if = {# Bristol
			limit = { has_title = title:c_gloucestershire }
			title:c_gloucestershire = {
				save_scope_as = bryten_english_bristol
			}
			set_global_variable = {
				name = bryten_english_created_bristol
				value = yes
			}
		}
		if = {# Norwich
			limit = { has_title = title:c_norfolk }
			title:c_norfolk = {
				save_scope_as = bryten_english_norwich
			}
			save_scope_as = bryten_english_norwich
			set_global_variable = {
				name = bryten_english_created_norwich
				value = yes
			}
		}
	}

	trigger = {
		OR = {# must own an important English city
			has_title = title:c_hampton # Winchester
			has_title = title:c_north_riding # York
			has_title = title:c_middlesex # London
			has_title = title:c_oxfordshire # Oxford
			has_title = title:c_lincolnshire # Lincoln
			has_title = title:c_gloucestershire # bristol and Glouscster
			has_title = title:c_norfolk # Norwich
		}
		AND = {
			not = {	exists = global_var:bryten_english_created_winchester }
			not = {	exists = global_var:bryten_english_created_york }
			not = {	exists = global_var:bryten_english_created_london }
			not = {	exists = global_var:bryten_english_created_oxford }
			not = {	exists = global_var:bryten_english_created_lincoln }
			not = {	exists = global_var:bryten_english_created_bristol }
			not = {	exists = global_var:bryten_english_created_norwich }
		}
		culture = { has_cultural_pillar = heritage_frankish }
		current_date >= 1150.1.1
	}

	option = {# Winchester
		name = bryten_england.102.city
		trigger = {	has_title = title:c_hampton	}
		scope:bryten_english_winchester = {	set_county_culture = culture:english }
	}
	option = {# York
		name = bryten_england.102.city
		trigger = {	has_title = title:c_north_riding	}
		scope:bryten_english_york = {	set_county_culture = culture:english }
	}
	option = {# London
		name = bryten_england.102.city
		trigger = {	has_title = title:c_middlesex	}
		scope:bryten_english_london = {	set_county_culture = culture:english }
	}	
	option = {# Oxford
		name = bryten_england.102.city
		trigger = {	has_title = title:c_oxfordshire	}
		scope:bryten_english_oxford = {	set_county_culture = culture:english }
	}
	option = {# Lincoln
		name = bryten_england.102.city
		trigger = {	has_title = title:c_lincolnshire	}
		scope:bryten_english_lincoln = {	set_county_culture = culture:english }
	}
	option = {# Glouscster
		name = bryten_england.102.city
		trigger = {	has_title = title:c_gloucestershire	}
		scope:bryten_english_bristol = {	set_county_culture = culture:english }
	}
	option = {# Norwich
		name = bryten_england.102.city
		trigger = {	has_title = title:c_norfolk	}
		scope:bryten_english_norwich = {	set_county_culture = culture:english }
	}
}
bryten_england.103 = {# The king has embraced English Culture
	type = character_event
	title = bryten_england.103.t
	desc = bryten_england.103.desc
	theme = culture_change
	left_portrait = {
		character = scope:embracer
		animation = personality_bold
	}

	immediate = {
		save_scope_as = embracer
		culture = { save_scope_as = embracer_former_culture }
	}

	option = {
		name = bryten_england.103.a
		embrace_english_culture_effect = yes
		hidden_effect = { # Moved here from embrace_english_culture_decision
			# Send event to other players
			every_player = {
				limit = {
					NOT = { this = root }
					OR = {
						primary_title = {
							OR = {
								de_jure_liege = title:e_britannia
								de_jure_liege.de_jure_liege = title:e_britannia
								de_jure_liege.de_jure_liege.de_jure_liege = title:e_britannia
							}
						}
						culture = { has_cultural_pillar = heritage_north_germanic }
						culture = { has_cultural_pillar = heritage_central_germanic }
						culture = { has_cultural_pillar = heritage_west_germanic }
						culture = { has_cultural_pillar = heritage_goidelic }
						culture = { has_cultural_pillar = heritage_brythonic }
					}
				}
				trigger_event = bryten_england.104
			}
		}
	}
}
bryten_england.104 = {# Players informed
	type = character_event
	title = bryten_england.103.t
	desc = bryten_england.104.desc
	theme = culture_change
	left_portrait = {
		character = scope:embracer
		animation = personality_bold
	}

	option = { # Not norman
		name = bryten_england.103.a
		trigger = {
			NOT = { has_culture = scope:embracer.culture }
		}
	}
	option = { # Also norman
		name = bryten_england.104.b
		trigger = {
			has_culture = scope:embracer.culture
		}
	}
}

#######################################
# Pilgrimage to Bury St. Edmunds
#######################################
bryten_england.125 = {# The martydom of Edmund. 
	type = character_event
	title = bryten_england.125.t
	desc = bryten_england.125.desc
	theme = friendly
	left_portrait = {
		character = scope:edumund
		animation = happiness
	}

	trigger = {
		has_title = title:k_east_anglia
		not = {	exists = global_var:bryten_monks_take_cuthbert } # Fire Only Once
		this = character:163111
	}

	immediate = {
		character:163064 = { save_scope_as = edumund }
		set_global_variable = {
			name = bryten_monks_take_cuthbert
			value = yes
		}
	}
	
	option = { # Ok
		name = bryten_england.125.edmund
		scope:edumund = {
			death = natural
		}
	}

	after = {
		every_ruler = {# Let other English Kings know of his death
			if = {
				limit = {
					OR = {
						has_primary_title = title:k_kent
						has_primary_title = title:k_northumbria
						has_primary_title = title:k_mercia
						has_primary_title = title:k_wessex
						has_primary_title = title:k_essex
					}
				}
				trigger_event = {
					id = bryten_england.126
					days = { 10 20 }
				}
			}
		}
	}
		
}
bryten_england.126 = {# The martydom of Edmund - other kings of England are informed
	type = character_event
	title = bryten_england.126.t
	desc = bryten_england.126.desc
	theme = friendly
	
	option = { # Ok
		name = bryten_england.126.edmund
	}
		
}
bryten_england.127 = {# The cult of St. Edmund the Martyr 
	type = character_event
	title = bryten_england.127.t
	desc = bryten_england.127.desc
	theme = friendly
	left_portrait = {
		character = root
		animation = happiness
	}

	trigger = {
		OR = {# Have to own territory in East Anglia
			has_title = title:k_east_anglia
			has_title = title:d_east_anglia
			has_title = title:d_norfolk
			has_title = title:c_norfolk
			has_title = title:c_suffolk
			has_title = title:c_cambridgeshire
		}
		religion = religion:christianity_religion # Got to be a Christian
		not = {	exists = global_var:bryten_saint_edmund_cult } # Fire Only Once
	}

	immediate = {
		set_global_variable = {
			name = bryten_saint_edmund_cult
			value = yes
		}
	}
	
	option = { # interesting
		name = bryten_england.127.cult
	}
		
}
bryten_england.128 = {# The abbey at Bury St. Edmunds. 
	type = character_event
	title = bryten_england.128.t
	desc = bryten_england.128.desc
	theme = friendly
	left_portrait = {
		character = root
		animation = happiness
	}

	immediate = {
		title:b_beodericsworth = {
			save_scope_as = bury_saint_edmunds_title
		}
		set_global_variable = {
			name = bryten_bury_saint_edmunds
			value = yes
		}
	}

	option = { # Ok
		name = bryten_england.128.abbey
		custom_tooltip = bryten_pilgrimage_durham_available_tooltip
		title:b_beodericsworth = {
			set_title_name = b_bury_st_edmunds
		}
	}
		
}
# Pilgrimage to Durham it self
bryten_england.130 = {# Make preparations to begin the pilgrimage
	type = character_event
	title = bryten_england.130.t
	desc = bryten_england.130.desc
	theme = friendly
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_faith.dds"
	}
	right_portrait = root
	
	immediate = {
		# Stop characters from planning multiple activities at once
		add_character_flag = planning_an_activity
	}
	
	option = { # Ok
		name = bryten_england.130.pilgrimage
		title:b_beodericsworth.title_province = {	
			spawn_activity = {
				owner = root
				type = activity_edmund_pilgrimage
			}	
		}
	}
}
bryten_england.131 = {# Pilgrimage begins
	type = character_event
	title = bryten_england.131.t
	desc = bryten_england.131.desc
	theme = friendly
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_faith.dds"
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	immediate = {
		play_music_cue = "mx_cue_epic_sacral_moment"
	}
	
	option = { # Ok
		name = bryten_england.131.pilgrimage

	}

	after = {
		trigger_event = {
			id = bryten_england.132
			days = { 10 20 }
		}
	}

}
bryten_england.132 = {# Arrive in Bury Saint Edmunds
	type = character_event
	title = bryten_england.132.t
	desc = bryten_england.132.desc
	theme = friendly
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # Ok
		name = bryten_england.132.arrival
	}

	after = {
		trigger_event = {
			id = bryten_england.133
			days = { 4 12 }
		}
	}

}
bryten_england.133 = {# Meditating in the abbey
	type = character_event
	title = bryten_england.133.t
	desc = bryten_england.133.desc
	theme = faith
	
	left_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # Ok
		name = bryten_england.133.abbey
	}

	after = {
		trigger_event = {
			id = bryten_england.134
			days = { 3 6 }
		}
	}
}
bryten_england.134 = {# Visiting the Edmund.
	type = character_event
	title = bryten_england.134.t
	desc = bryten_england.134.desc
	theme = faith
	
	left_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # Ok
		name = bryten_england.134.edmund
	}

	after = {
		trigger_event = {
			id = bryten_england.135
			days = { 4 12 }
		}
	}
}
bryten_england.135 = {# Preparing to return home
	type = character_event
	title = bryten_england.135.t
	desc = bryten_england.135.desc
	theme = friendly
	override_background = { event_background = alley_day }
	
	right_portrait = root
	
	option = { # Ok
		name = bryten_england.135.home
	}

	after = {
		trigger_event = {
			id = bryten_england.136
			days = { 10 25 }
		}
	}

}
bryten_england.136 = {# Return home
	type = character_event
	title = bryten_england.136.t
	desc = bryten_england.136.desc
	theme = friendly
	
	left_portrait = {
		character = root
		animation = happiness
	}
	
	option = { # Ok
		name = bryten_england.136.home
		add_piety = medium_piety_gain
		pilgrimage_additional_reward_effect = yes
		add_trait = pilgrim
	}
	
	after = {
		trigger_event = {
			id = bryten_england.137
			days = 1
		}
	}	
}
bryten_england.137 = {# Misc Cleanup file
	hidden = yes	
	immediate = {
		remove_character_flag = bryten_pilgrimage_edmund
		scope:activity = {
			complete_activity = yes
		}
	}
}
#######################################
# Pilgrimage to Durham
#######################################
bryten_england.140 = {# The Monks of Lindisfarne move the body of St. Cuthbert. 
	type = character_event
	title = bryten_england.140.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { religion = religion:germanic_religion }
				desc = bryten_england.140.desc.pagan
			}
			triggered_desc = {
				trigger = { religion = religion:christianity_religion }
				desc = bryten_england.140.desc.christian
			}
		}
	}


	theme = friendly
	left_portrait = {
		character = root
		animation = happiness
	}

	trigger = {
		has_title = title:c_northumberland
		not = {	exists = global_var:bryten_monks_take_cuthbert } # Fire Only Once
		current_date <= 900.1.1 # The monks left in the 9th century
	}

	immediate = {
		set_global_variable = {
			name = bryten_monks_take_cuthbert
			value = yes
		}
	}
	
	option = { # Ok
		name = bryten_england.140.pagan
	}
	option = { # Ok
		name = bryten_england.140.christian

	}
		
}
bryten_england.141 = {# The Monks bring his body to Durham
	type = character_event
	title = bryten_england.141.t
	desc = bryten_england.141.desc
	theme = friendly
	
	left_portrait = {
		character = root
		animation = happiness
	}
	
	trigger = {
		has_title = title:c_durham
		exists = global_var:bryten_monks_take_cuthbert # The monks have to take the body
		not = {	exists = global_var:bryten_monks_cuthbert_durham } # Fire Only Once
		current_date <= 900.1.1 # The monks get there seven years later.
	}

	immediate = {
		set_global_variable = {
			name = bryten_monks_cuthbert_durham
			value = yes
		}
	}
	
	option = { # Ok
		name = bryten_england.141.durham
	}
		
}
bryten_england.142 = {# Building the tomb for St. Cuthbert. 
	type = character_event
	title = bryten_england.142.t
	desc = bryten_england.142.desc
	theme = friendly
	
	left_portrait = {
		character = root
		animation = happiness
	}

	trigger = {
		has_title = title:c_durham
		exists = global_var:bryten_monks_cuthbert_durham # The monks have to take the body
		not = {	exists = global_var:bryten_cuthbert_tomb } # Fire Only Once
		any_realm_province = {
			has_building = bryten_building_durham_cathedral_01
		}
	}

	immediate = {
		set_global_variable = {
			name = bryten_cuthbert_tomb
			value = yes
		}
	}
	
	option = { # Ok
		name = bryten_england.142.tomb
		custom_tooltip = bryten_pilgrimage_durham_available_tooltip
	}
		
}
bryten_england.143 = {# St. Cuthbert's Gospel of John.
	type = character_event
	title = bryten_england.143.t
	desc = bryten_england.143.desc
	theme = friendly
	left_portrait = {
		character = root
		animation = happiness
	}

	trigger = {
		has_title = title:c_durham
		not = {	exists = global_var:bryten_cuthbert_gospel } # Fire Only Once
		any_realm_province = {
			has_building = bryten_building_durham_cathedral_02
		}
	}

	immediate = {
		set_global_variable = {
			name = bryten_cuthbert_gospel
			value = yes
		}
	}

	
	option = { # Ok
		name = bryten_england.143.gospel
		add_piety = medium_piety_gain
	}
		
}
# Pilgrimage to Durham it self
bryten_england.150 = {# Make preparations to begin the pilgrimage
	type = character_event
	title = bryten_england.150.t
	desc = bryten_england.150.desc
	theme = friendly
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_faith.dds"
	}
	right_portrait = root
	
	immediate = {
		# Stop characters from planning multiple activities at once
		add_character_flag = planning_an_activity
	}
	
	option = { # Ok
		name = bryten_england.150.pilgrimage
		title:c_durham.title_province = {	
			spawn_activity = {
				owner = root
				type = activity_durham_pilgrimage
			}	
		}
	}
}
bryten_england.151 = {# Pilgrimage begins
	type = character_event
	title = bryten_england.151.t
	desc = bryten_england.151.desc
	theme = friendly
	override_icon = {
		reference = "gfx/interface/icons/event_types/type_faith.dds"
	}
	
	left_portrait = {
		character = root
		animation = happiness
	}

	immediate = {
		play_music_cue = "mx_cue_epic_sacral_moment"
	}
	
	option = { # Ok
		name = bryten_england.151.pilgrimage

	}

	after = {
		trigger_event = {
			id = bryten_england.152
			days = { 10 20 }
		}
	}

}
bryten_england.152 = {# Arrive in Durham
	type = character_event
	title = bryten_england.152.t
	desc = bryten_england.152.desc
	theme = friendly
	
	right_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # Ok
		name = bryten_england.152.arrival

	}

	after = {
		trigger_event = {
			id = bryten_england.153
			days = { 4 12 }
		}
	}

}
bryten_england.153 = {# Meditating in Durham Cathedral
	type = character_event
	title = bryten_england.153.t
	desc = bryten_england.153.desc
	theme = faith
	
	left_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # Ok
		name = bryten_england.153.cathedral
	}

	after = {
		trigger_event = {
			id = bryten_england.154
			days = { 3 6 }
		}
	}
}
bryten_england.154 = {# Visiting the Tomb of the Venerable Bede
	type = character_event
	title = bryten_england.154.t
	desc = bryten_england.154.desc
	theme = faith
	
	left_portrait = {
		character = root
		animation = personality_content
	}
	
	immediate = {
		play_music_cue = mx_cue_sacredrite
	}
	
	option = { # Ok
		name = bryten_england.154.bede
	}
	
	after = {
		trigger_event = {
			id = bryten_england.155
			days = { 1 6 }
		}
	}
	
}
bryten_england.155 = {# Visiting the Tomb of St. Cuthbert.
	type = character_event
	title = bryten_england.155.t
	desc = bryten_england.155.desc
	theme = faith
	
	left_portrait = {
		character = root
		animation = personality_zealous
	}
	
	option = { # Ok
		name = bryten_england.155.cuthbert
	}

	after = {
		trigger_event = {
			id = bryten_england.156
			days = { 4 12 }
		}
	}
}
bryten_england.156 = {# Preparing to return home
	type = character_event
	title = bryten_england.156.t
	desc = bryten_england.156.desc
	theme = friendly
	override_background = { event_background = alley_day }
	
	right_portrait = root
	
	option = { # Ok
		name = bryten_england.156.home
	}

	after = {
		trigger_event = {
			id = bryten_england.157
			days = { 10 25 }
		}
	}

}
bryten_england.157 = {# Return home
	type = character_event
	title = bryten_england.157.t
	desc = bryten_england.157.desc
	theme = friendly
	
	left_portrait = {
		character = root
		animation = happiness
	}
	
	option = { # Ok
		name = bryten_england.157.home
		add_piety = medium_piety_gain
		pilgrimage_additional_reward_effect = yes
		add_trait = pilgrim
	}
	
	after = {
		trigger_event = {
			id = bryten_england.158
			days = 1
		}
	}	
}
bryten_england.158 = {# Misc Cleanup file
	hidden = yes	
	immediate = {
		remove_character_flag = bryten_pilgrimage_durham
		scope:activity = {
			complete_activity = yes
		}
	}
}
