#######################################
#									  #
#         Anglo-Saxon Effects  	      #
#									  #
#######################################
unite_kingdom_england_decision_effects = {# Uniting England
	# Create the title and make it primary
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:k_england = {
		change_title_holder = {
			holder = root
			change = scope:title_change
		}
	}

	if = {
		limit = { scope:spain_uniter.primary_title = title:k_mercia }
		primary_title = { set_coa = k_england_mercia }
	}
	else_if = {
		limit = { scope:spain_uniter.primary_title = title:k_northumbria }
		primary_title = { set_coa = k_england_northumbria }
	}
	else_if = {
		limit = { scope:spain_uniter.primary_title = title:k_east_anglia }
		primary_title = { set_coa = k_england_east_anglia }
	}
	else_if = {
		limit = { scope:spain_uniter.primary_title = title:k_kent }
		primary_title = { set_coa = k_england_kent }
	}
	else_if = {
		limit = { scope:spain_uniter.primary_title = title:k_wessex }
		primary_title = { set_coa = k_england }
	}


	resolve_title_and_vassal_change = scope:title_change
	set_primary_title_to = title:k_england




	title:k_kent = { add_to_list = english_kingdoms }
	title:k_northumbria = { add_to_list = english_kingdoms }
	title:k_mercia = { add_to_list = english_kingdoms }
	title:k_east_anglia = { add_to_list = english_kingdoms }
	title:k_wessex = { add_to_list = english_kingdoms }
	title:k_essex = { add_to_list = english_kingdoms }

	every_in_list = {
		list = english_kingdoms
		every_in_de_jure_hierarchy = {
			limit = {
				tier = tier_duchy
			}
			set_de_jure_liege_title = title:k_england
		}
	}

	hidden_effect = {
		if = {
			limit = { has_title = title:k_kent }
			destroy_title = title:k_kent
		}
		if = {
			limit = { has_title = title:k_northumbria }
			destroy_title = title:k_northumbria
		}
		if = {
			limit = { has_title = title:k_mercia }
			destroy_title = title:k_mercia
		}
		if = {
			limit = { has_title = title:k_east_anglia }
			destroy_title = title:k_east_anglia
		}
		if = {
			limit = { has_title = title:k_wessex }
			destroy_title = title:k_wessex
		}
		if = {
			limit = { has_title = title:k_essex }
			destroy_title = title:k_essex
		}
	}
}
restore_kingdom_kent_decision_scripted_effect = {# Restoring The Kingdom of Kent
	# Create the title and make it primary
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:k_kent = {
		change_title_holder = {
			holder = root
			change = scope:title_change
		}
	}

	resolve_title_and_vassal_change = scope:title_change
	set_primary_title_to = title:k_kent

	title:d_canterbury = { add_to_list = kentish_kingdom }


	every_in_list = {
		list = kentish_kingdom
		every_in_de_jure_hierarchy = {
			limit = {
				tier = tier_duchy
			}
			set_de_jure_liege_title = title:k_kent
		}
	}

}
restore_kingdom_essex_decision_scripted_effect = {# Restoring The Kingdom of Essex
	# Create the title and make it primary
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
		add_claim_on_loss = no
	}
	title:k_essex = {
		change_title_holder = {
			holder = root
			change = scope:title_change
		}
	}

	resolve_title_and_vassal_change = scope:title_change
	set_primary_title_to = title:d_bedford

	title:d_bedford = { add_to_list = essex_kingdom }


	every_in_list = {
		list = essex_kingdom
		every_in_de_jure_hierarchy = {
			limit = {
				tier = tier_duchy
			}
			set_de_jure_liege_title = title:k_essex
		}
	}

}
unify_anglo_saxon_culture_effect = {# Unifying Anglo Saxon
	# Scopes saves for localization
	root = { save_scope_as = unifier }
	# Prestige Bonus
	add_prestige = medium_prestige_gain

	#Convert your, and your whole family's, culture
	set_culture = culture:anglo_saxon
	if = {
		limit = { any_spouse = { is_landed = no } }
		every_spouse = {
			limit = {
				is_landed = no
			}
			set_culture = culture:anglo_saxon
		}
	}
	if = {
		limit = {
			any_close_family_member = {
				is_landed = no
				NOT = { is_spouse_of = root }
			}
		}
		every_close_family_member = {
			limit = {
				is_landed = no
				NOT = { is_spouse_of = root }
			}
			custom = all_unlanded_family_members
			set_culture = culture:anglo_saxon
		}
	}

	#Convert appropriate vassals, and their family
	if = {
		limit = {
			any_vassal_or_below = {
				is_ai = yes
				OR = {
					culture = culture:mercian
					culture = culture:northumbrian
					culture = culture:west_saxon
				}
				primary_title = {
					OR = {
						de_jure_liege = title:k_england
						de_jure_liege.de_jure_liege = title:k_england
						de_jure_liege.de_jure_liege.de_jure_liege = title:k_england
					}
				}
			}
		}
		every_vassal_or_below = {
			custom = embrace_english_culture_vassals_custom
			limit = {
				is_ai = yes
				OR = {
					culture = culture:mercian
					culture = culture:northumbrian
					culture = culture:west_saxon
				}
				primary_title = {
					OR = {
						de_jure_liege = title:k_england
						de_jure_liege.de_jure_liege = title:k_england
						de_jure_liege.de_jure_liege.de_jure_liege = title:k_england
					}
				}
			}
			set_culture = culture:anglo_saxon
		}
	}

	#Flip Counties
	every_county_in_region = {
		region = custom_england
		custom = unify_anglo_saxon_culture_counties_custom
		limit = {
			target_is_de_facto_liege_or_above = root.primary_title
			OR = {
				culture = culture:mercian
				culture = culture:northumbrian
				culture = culture:west_saxon
			}
			NOT = { culture = culture:anglo_norse }

		}
		set_county_culture = culture:anglo_saxon
	}
	culture:anglo_saxon = {
		custom_tooltip = decision_unify_anglo_saxon_culture_get_innovations
		hidden_effect = {
			reset_culture_creation_date = yes
			get_all_innovations_from = culture:mercian
			get_all_innovations_from = culture:northumbrian
			get_all_innovations_from = culture:west_saxon
		}
	}
}
#######################################
#									  #
#         Anglo-Norse Effects  	      #
#									  #
#######################################
embrace_anglo_norse_culture_effect = {# embracing Anglo-Norse
	# Scopes saves for localization
	root = {
		save_scope_as = embracer
	}
	# Prestige Bonus
	add_prestige = medium_prestige_gain

	#Convert your, and your whole family's, culture
	set_culture = culture:anglo_norse
	if = {
		limit = { any_spouse = { is_landed = no } }
		every_spouse = {
			limit = {
				is_landed = no
			}
			set_culture = culture:anglo_norse
		}
	}
	if = {
		limit = {
			any_close_family_member = {
				is_landed = no
				NOT = { is_spouse_of = root }
			}
		}
		every_close_family_member = {
			limit = {
				is_landed = no
				NOT = { is_spouse_of = root }
			}
			custom = all_unlanded_family_members
			set_culture = culture:anglo_norse
		}
	}

	#Convert appropriate vassals, and their family
	if = {
		limit = {
			any_vassal_or_below = {
				is_ai = yes
				culture = { has_cultural_pillar = heritage_west_germanic }
				capital_province = { geographical_region = custom_england }
			}
		}
		every_vassal_or_below = {
			custom = embrace_english_culture_vassals_custom
			limit = {
				is_ai = yes
				culture = { has_cultural_pillar = heritage_west_germanic }
				capital_province = { geographical_region = custom_england }
			}
			set_culture = culture:anglo_norse
		}
	}

	#Flip Counties
	every_county_in_region = {
		region = custom_england
		custom = embrace_english_culture_counties_custom
		limit = {
			target_is_de_facto_liege_or_above = root.primary_title
		}
		random = {
			chance = 60
			set_county_culture = culture:anglo_norse
		}
	}

	culture:anglo_norse = {
		custom_tooltip = decision_embrace_anglo_norse_culture_get_innovations
		hidden_effect = {
			get_all_innovations_from = culture:norse
			get_all_innovations_from = culture:northumbrian
		}
	}
}
#######################################
#									  #
#       Norman/English Effects  	  #
#									  #
#######################################
establish_norman_adminstration_effects = {# Establishing the Norman Adminstration
	scope:norman_england_king = {
		create_title_and_vassal_change = {
			type = conquest
			save_scope_as = change
		}
		hidden_effect = {
			add_realm_law_skip_effects = partition_succession_law

	

			# The Duchy of Bedford
			title:c_middlesex = { set_de_jure_liege_title = title:d_bedford }
			title:c_essex = { set_de_jure_liege_title = title:d_bedford }
			title:c_bedford = { set_de_jure_liege_title = title:d_bedford }
			title:c_hertfordshire = { set_de_jure_liege_title = title:d_bedford }
			title:c_buckinghamshire = { set_de_jure_liege_title = title:d_bedford }
			# The Duchy of Northumberland
			title:c_northumberland = { set_de_jure_liege_title = title:d_northumberland }
			title:c_durham = { set_de_jure_liege_title = title:d_northumberland }
			# The Duchy of Lancaster
			title:c_lancashire = { set_de_jure_liege_title = title:d_lancaster }
			title:c_westmorland = { set_de_jure_liege_title = title:d_lancaster }
			title:c_cheshire = { set_de_jure_liege_title = title:d_lancaster }
			title:c_derby = { set_de_jure_liege_title = title:d_lancaster }
			# The Duchy of Norfolk
			title:c_norfolk = { set_de_jure_liege_title = title:d_norfolk }
			title:c_suffolk = { set_de_jure_liege_title = title:d_norfolk }
			title:c_cambridgeshire = { set_de_jure_liege_title = title:d_norfolk }
			# The Duchy of hereford
			title:c_warwickshire = { set_de_jure_liege_title = title:d_hereford }
			title:c_leicestershire = { set_de_jure_liege_title = title:d_hereford }
			title:c_nottinghamshire = { set_de_jure_liege_title = title:d_hereford }
			title:c_staffordshire = { set_de_jure_liege_title = title:d_hereford }
			title:c_worcestershire = { set_de_jure_liege_title = title:d_hereford }
			title:c_huntingdonshire = { set_de_jure_liege_title = title:d_hereford }
			title:c_northamptonshire = { set_de_jure_liege_title = title:d_hereford }
			title:c_shropshire = { set_de_jure_liege_title = title:d_hereford }
			# The Duchy of Gloucester
			title:c_gloucestershire = { set_de_jure_liege_title = title:d_gloucester }
			title:c_wiltshire = { set_de_jure_liege_title = title:d_gloucester }
			title:c_oxfordshire = { set_de_jure_liege_title = title:d_gloucester }
			title:c_berkshire = { set_de_jure_liege_title = title:d_gloucester }
			# The Duchy of Canterbury
			title:c_kent = { set_de_jure_liege_title = title:d_canterbury }
			title:c_surrey = { set_de_jure_liege_title = title:d_canterbury }
			title:c_sussex = { set_de_jure_liege_title = title:d_canterbury }
			# The Duchy of Somerset
			title:c_hampton = { set_de_jure_liege_title = title:d_somerset }
			title:c_isle_of_wight = { set_de_jure_liege_title = title:d_somerset }
			title:c_somerset = { set_de_jure_liege_title = title:d_somerset }
			title:c_dorset = { set_de_jure_liege_title = title:d_somerset }
			if = {
				limit = { 
					AND = {
						is_ai = yes
						has_title = title:d_brambugh 
					}
				}
				destroy_title = title:d_brambugh
			}
			if = {
				limit = {
					AND = {
						is_ai = yes
						has_title = title:d_east_anglia 
					}
				}
				destroy_title = title:d_east_anglia
			}
			if = {
				limit = { 
					AND = {
						is_ai = yes
						has_title = title:d_wessex 
					}					
				}
				destroy_title = title:d_wessex
			}
			if = {
				limit = {
					AND = {
						is_ai = yes
						has_title = title:d_kent 
					}					
				}
				destroy_title = title:d_kent
			}
			if = {
				limit = {
					AND = {
						is_ai = yes
						has_title = title:d_five_burhs 
					}					
					
				}
				destroy_title = title:d_five_burhs
			}
			if = {
				limit = {
					AND = {
						is_ai = yes
						has_title = title:d_mercia 
					}					
				}
				destroy_title = title:d_mercia
			}
			if = {
				limit = {
					AND = {
						is_ai = yes
						has_title = title:d_essex 
					}					
				}
				destroy_title = title:d_essex
			}
			resolve_title_and_vassal_change = scope:change

		}
	}
}
embrace_english_culture_effect = {# embracing English
	# Scopes saves for localization
	root = {
		save_scope_as = embracer
	}

	# Prestige Bonus
	add_prestige = medium_prestige_gain

	#Convert your, and your whole family's, culture
	set_culture = culture:english
	if = {
		limit = { any_spouse = { is_landed = no } }
		every_spouse = {
			limit = {
				is_landed = no
			}
			set_culture = culture:english
		}
	}
	if = {
		limit = {
			any_close_family_member = {
				is_landed = no
				NOT = { is_spouse_of = root }
			}
		}
		every_close_family_member = {
			limit = {
				is_landed = no
				NOT = { is_spouse_of = root }
			}
			custom = all_unlanded_family_members
			set_culture = culture:english
		}
	}

	#Convert appropriate vassals, and their family
	if = {
		limit = {
			any_vassal_or_below = {
				is_ai = yes
				OR = {
					culture = culture:norman
					culture = culture:french
				}
				primary_title = {
					OR = {
						de_jure_liege = title:k_england
						de_jure_liege.de_jure_liege = title:k_england
						de_jure_liege.de_jure_liege.de_jure_liege = title:k_england
					}
				}
			}
		}
		every_vassal_or_below = {
			custom = embrace_english_culture_vassals_custom
			limit = {
				is_ai = yes
				OR = {
					culture = culture:norman
					culture = culture:french
				}
				primary_title = {
					OR = {
						de_jure_liege = title:k_england
						de_jure_liege.de_jure_liege = title:k_england
						de_jure_liege.de_jure_liege.de_jure_liege = title:k_england
					}
				}
			}
			set_culture = culture:english
		}
	}

	#Flip Counties
	every_county_in_region = {
		region = custom_england
		custom = embrace_english_culture_counties_custom
		limit = {
			target_is_de_facto_liege_or_above = root.primary_title
		}
		random = {
			chance = 40
			set_county_culture = culture:english
		}
	}

	culture:english = {
		custom_tooltip = decision_embrace_english_culture_get_innovations
		hidden_effect = {
			get_all_innovations_from = culture:norman
			get_all_innovations_from = culture:anglo_saxon
		}
	}
}
#######################################
#									  #
#         Irish Effects  	      	  #
#									  #
#######################################
strengthen_high_king_decision_effects = {
	### Give k_ireland to scope:high_king_ireland.
	create_title_and_vassal_change = {
		type = created
		save_scope_as = title_change
	}
	title:k_ireland = {
		change_title_holder = {
			holder = scope:high_king_ireland
			change = scope:title_change
		}
	}
	resolve_title_and_vassal_change = scope:title_change
	### Give the de jure Ireland the list of all the kings.
	hidden_effect = {
		title:k_ireland = {

			# & title history.
			copy_title_history = title:k_ireland_titular
		}
	}
	### Destroy k_ireland_titular.
	destroy_title = title:k_ireland_titular
	# All claims on k_ireland_titular become claims on k_ireland
	title:k_ireland_titular = {
		every_claimant = {
			custom = strengthen_high_king_decision_effects.all_claimants
			remove_claim = title:k_ireland_titular
			add_unpressed_claim = title:k_ireland
		}
	}
}
#######################################
#									  #
#         Scottish Effects  	      #
#									  #
#######################################
create_lothian_duchy_effects = {
	scope:lothian_duchy_creator = {
		# create the duchy
		create_title_and_vassal_change = {
			type = created
			save_scope_as = title_change
			add_claim_on_loss = no
		}
		title:d_lothian = {
			change_title_holder = {
				holder = scope:lothian_duchy_creator
				change = scope:title_change
			}
		}
		resolve_title_and_vassal_change = scope:title_change
		##Configure the new de jure setup.
		title:c_lothian = { set_de_jure_liege_title = title:d_lothian }
		title:c_dunbar = { set_de_jure_liege_title = title:d_lothian }
		title:c_teviotdale = { set_de_jure_liege_title = title:d_lothian }
		title:c_linlithgowshire = { set_de_jure_liege_title = title:d_lothian }
		title:c_lanarkshire = { set_de_jure_liege_title = title:d_lothian }
	}
}
integrate_strathclyde_kingdom_effect = {
	##Configure the new de jure setup.
	title:d_galloway = { set_de_jure_liege_title = title:k_scotland }
	hidden_effect = {
		if = {
			limit = { has_title = title:k_strathclyde }
			destroy_title = title:k_strathclyde
		}
	}
}
