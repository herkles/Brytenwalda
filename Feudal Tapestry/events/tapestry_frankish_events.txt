namespace = tapestry_frankish

#######################################
# Frankish Cultural Split up
#######################################
tapestry_frankish.001 = {# splitting up the culture
	scope = none
	hidden = yes
	
	immediate = {
		# Split the Frankish culture into French, Lotharingian/Lorraine/Franconian
		culture:frankish = { save_scope_as = frankish } # Save scope for player notification events.
		culture:french = {
			# 'Diverge' this culture by copying innovations/traditions.
			get_all_innovations_from = scope:frankish
			# Save scope for player notification events.
			save_scope_as = french 
		}
		culture:lorrainian = {
			# 'Diverge' this culture by copying innovations/traditions.
			get_all_innovations_from = scope:frankish
			# Save scope for player notification events.
			save_scope_as = lorrainian 
		}
		culture:lothringian = {
			# 'Diverge' this culture by copying innovations/traditions.
			get_all_innovations_from = scope:frankish
			# Save scope for player notification events.
			save_scope_as = lothringian 
		}		
		culture:franconian = {
			# 'Diverge' this culture by copying innovations/traditions.
			reset_culture_creation_date = yes
			get_all_innovations_from = scope:frankish
			# Save scope for player notification events.
			save_scope_as = franconian 
		}
		culture:burgundian = {
			# 'Diverge' this culture by copying innovations/traditions.
			get_all_innovations_from = scope:frankish
			# Save scope for player notification events.
			save_scope_as = burgundian 
		}
		culture:gallo = {
			# 'Diverge' this culture by copying innovations/traditions.
			get_all_innovations_from = scope:frankish
			# Save scope for player notification events.
			save_scope_as = gallo 
		}
		# Compile a list of all Frankish counties in the frankish empire to convert to the appropriate culture.
		every_county = {
			limit = {
				# All Frankish counties in Frankia will convert to the appropriate culture.
				culture = culture:frankish
				title_province = {
					OR = {
						geographical_region = world_europe_west_germania
						geographical_region = world_europe_west_francia
					}
				}
			}
			add_to_list = frankish_counties
		}


		title:d_anjou = {# if Britanny controls Anjou then Gallo Gets to spread further.
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
					OR = {
						culture = culture:frankish
						culture = culture:french
					}
					title_province = { geographical_region = custom_anjou }
					holder = { has_primary_title = title:k_brittany }
				}
				set_county_culture = culture:gallo	
			}
		}
		title:d_burgundy = {# if Burgundy is controlled by a burgundian then burgundian spreads northwards.
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
					OR = {
						culture = culture:frankish
						culture = culture:french
					}
					title_province = { geographical_region = custom_burgundy }
					holder = { has_culture = culture:burgundian }
				}
				set_county_culture = culture:burgundian	
			}
		}
		title:d_lower_lorraine = {# if Burgundy is controlled by a burgundian then burgundian spreads northwards.
			every_in_de_jure_hierarchy = {
				limit = {
					tier = tier_county
					OR = {
						culture = culture:frankish
						culture = culture:franconian
					}
					title_province = { geographical_region = ghw_region_germanic }
					holder = { has_primary_title = title:k_lotharingia }
				}
				set_county_culture = culture:lothringian	
			}
		}

		# Convert the Frankish counties to the new culture.
		every_in_list = {
			list = frankish_counties
			# First make Lotharingian
			convert_county_and_holder_if_in_region_effect = {
				OLD_CULTURE = culture:frankish
				NEW_CULTURE = culture:lorrainian
				REGION = custom_french_lotharingia
			}
			convert_county_and_holder_if_in_region_effect = {
				OLD_CULTURE = culture:frankish
				NEW_CULTURE = culture:lothringian
				REGION = custom_german_lotharingia
			}
			# Second, any frankish counties in West Francia become French
			convert_county_and_holder_if_in_region_effect = {
				OLD_CULTURE = culture:frankish
				NEW_CULTURE = culture:french
				REGION = world_europe_west_francia
			}
			# Finally, all remaining Frankish counties become franconian
			convert_county_and_holder_if_in_region_effect = {
				OLD_CULTURE = culture:frankish
				NEW_CULTURE = culture:franconian
				REGION = world_europe_west_germania
			}
		}

		# Send the appropriate notification event to each player.
	}
}
#######################################
# Treaty of Meerssen
#######################################
# tapestry_frankish.020 = {# Emperor Lothair dies
# 	scope = none
# 	hidden = yes
	
# 	trigger = {
# 		character:144998 = { NOT = { is_alive = yes } }
# 		is_alive = yes
# 		Not = { exists = global_var:bryten_lothair_passed_away }
# 	}
	
# 	immediate = {
# 		character:144998 = {
# 			save_scope_as = lothair
# 		}
# 		set_global_variable = {
# 			name = bryten_lothair_passed_away
# 			value = yes
# 		}
# 		if = {# Lothair has no children
# 			limit = {
# 				NOT = { any_child = { is_heir_of = scope:lothair } }
# 			}
# 			set_global_variable = {
# 				name = bryten_lothair_childless
# 				value = yes
# 			}
# 			character:144998 = { save_scope_as = bryten_lothair_childless }
# 		}
# 	}

# 	after = {
# 		if = {# Childless leads to treaty
# 			limit = {
# 				current_date <= 881.1.1 # should be before 880.
# 				exists = global_var:bryten_lothair_childless
# 				AND = {# making sure that charles and louis are alive
# 					character:90107 = { is_alive = yes }
# 					character:90104 = { is_alive = yes }
# 				} 
# 			}
# 			character:90107 = {
# 				trigger_event = tapestry_frankish.021
# 			}
# 		}		
# 	}
# }
# tapestry_frankish.021 = {# Charles the Bald sends treaty to Louis the German
# 	type = character_event
# 	title = tapestry_frankish.021.t
# 	desc = tapestry_frankish.021.desc
# 	theme = realm
# 	left_portrait = {
# 		character = root
# 		animation = personality_bold
# 	}

# 	trigger = {# to make sure that Charles and Louis are alive; just to be safe
# 		character:90107 = { is_alive = yes }
# 		character:90104 = { is_alive = yes }
# 	}
	
# 	option = {# Sign the Treaty
# 		name = tapestry_frankish.021.a
# 		ai_chance = { base = 95 }
# 		hidden_effect = {
# 			character:90104 = { trigger_event = tapestry_frankish.022 }
# 		}
# 	}
# 	option = {# Don't sign the Treaty
# 		name = tapestry_frankish.021.b
# 		ai_chance = { base = 5 }
# 		hidden_effect = {
# 			character:90104 = { trigger_event = tapestry_frankish.023 }
# 		}
# 	}

# }
# tapestry_frankish.022 = {# the treaty of meerssen is signed
# 	type = character_event
# 	title = tapestry_frankish.022.t
# 	desc = tapestry_frankish.022.desc
# 	theme = realm
	
# 	left_portrait = {
# 		character = root
# 		animation = personality_bold
# 	}
	
# 	immediate = { treaty_of_meerssen_scripted_effect = yes }


# 	option = { # Ok
# 		name = tapestry_frankish.022.a
# 	}
# }
# tapestry_frankish.023 = {# the treaty of meerssen isn't signed
# 	type = character_event
# 	title = tapestry_frankish.023.t
# 	desc = tapestry_frankish.023.desc
# 	theme = realm
# 	left_portrait = {
# 		character = root
# 		animation = personality_bold
# 	}
	
# 	option = { # Ok
# 		name = tapestry_frankish.023.a
# 	}
# }








